# 北京地铁线路规划系统

## 项目简介
这是一个基于 Python Flask 的北京地铁线路规划系统，能够为用户提供最短时间或最少换乘的地铁路线规划服务。系统采用可视化界面，让用户能够直观地选择起点和终点站，并展示详细的乘车路线。

## 主要功能
- 可视化地铁线路图展示
- 支持点击选择起点和终点站
- 提供两种路线规划模式：
  - 最短时间路线
  - 最少换乘路线
- 详细的换乘指引和站点信息
- 支持环形线路的双向路径规划

## 技术栈
- 后端：Python Flask
- 前端：HTML5, CSS3, JavaScript
- 数据存储：JSON 配置文件
- 算法：改进的 Dijkstra 算法（最短时间）和 DFS 算法（最少换乘）

## 项目结构
```
project/
│
├── app.py                 # Flask 应用主程序
├── main.py               # 生产环境启动程序
├── test.py               # 测试程序
├── services/
│   ├── subway_system.py   # 地铁系统核心类
│   ├── subway_planner.py  # 路线规划算法实现
│   └── data_loader.py     # 数据加载和处理
│
├── static/
│   ├── css/              # 样式文件
│   ├── js/               # JavaScript 文件
│   └── images/           # 图片资源
│
├── templates/
│   └── index.html        # 主页面模板
│
└── data/
    └── beijing_subway.json # 地铁线路数据
```

## 项目模块说明

### 核心模块
1. `subway_system.py`
   - 地铁系统的核心类实现
   - 管理站点和线路信息
   - 提供路线规划的统一接口
   - 负责调用不同的路线规划算法

2. `subway_planner.py`
   - 实现路线规划的核心算法
   - 包含最短时间算法（Dijkstra）
   - 包含最少换乘算法（DFS）
   - 处理环形线路的特殊情况

3. `data_loader.py`
   - 负责加载和解析地铁数据
   - 验证数据格式的正确性
   - 构建站点和线路的数据结构
   - 提供数据更新接口

### Web 应用模块
1. `app.py`
   - Flask 应用程序入口
   - 处理 HTTP 请求和路由
   - 提供 RESTful API 接口
   - 渲染前端页面

2. `templates/index.html`
   - 主页面模板
   - 展示地铁线路图
   - 处理用户交互
   - 显示查询结果

3. `static/js/main.js`
   - 前端交互逻辑
   - 处理站点点击事件
   - 发送 AJAX 请求
   - 更新页面显示

## 安装和运行
1. 确保已安装 Python 3.7 或更高版本
2. 安装依赖包：
```bash
pip install flask
```

## 启动程序的三种方式

1. 通过 app.py 运行（开发模式）
```bash
python app.py
```

2. 通过 main.py 运行（生产模式）
```bash
python main.py
```

3. 运行测试程序
```bash
python test.py
```

## 测试说明

### test.py 文件说明
test.py 文件用于测试地铁系统的核心功能，主要包括：
1. 测试路线规划功能
   - 测试最短时间路径规划
   - 测试最少换乘路径规划
   - 测试环形线路的双向路径规划

2. 测试数据加载功能
   - 测试站点数据加载
   - 测试线路数据加载
   - 测试站点间连接关系

测试用例包括：
- 西直门到雍和宫的环形线路测试
- 不同线路间的换乘测试
- 数据加载正确性测试
- 异常情况处理测试

## 使用说明
1. 打开系统后，您会看到北京地铁线路图
2. 点击任意站点选择起点（第一次点击）
3. 再次点击另一个站点选择终点（第二次点击）
4. 系统会自动计算并显示推荐路线
5. 如需重新选择，直接点击新的站点即可重新开始选择过程

## 特色功能
1. 智能换乘：自动计算最优换乘方案
2. 双向路径：支持环形线路的双向选择
3. 直观操作：点击式站点选择
4. 实时响应：选择站点后自动规划路线

